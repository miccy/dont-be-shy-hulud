# Socket.dev Configuration
# https://socket.dev/docs/configuration
#
# Recommended settings for protection against Shai-Hulud 2.0 and similar attacks
# Place this file in the root of your repository as .socket.yml

version: 2

# =============================================================================
# Issue Rules - Block or warn on risky behaviors
# =============================================================================

issueRules:
  # ðŸ”´ CRITICAL: Block these behaviors (Shai-Hulud attack vectors)
  installScripts:
    action: error
    comment: "Install scripts are the primary vector for Shai-Hulud 2.0"
  
  shellAccess:
    action: error
    comment: "Shell access can be used for credential theft"
  
  networkAccess:
    action: error
    comment: "Network access enables exfiltration"
  
  envVars:
    action: error
    comment: "Environment variable access can steal credentials"
  
  filesystemAccess:
    action: error
    comment: "Filesystem access can read ~/.npmrc, ~/.aws/credentials"
  
  binaryExecution:
    action: error
    comment: "Binary execution can run malicious payloads"

  # ðŸŸ  HIGH: Warn and require review
  newAuthor:
    action: warn
    comment: "New package author - verify legitimacy"
  
  criticalSeverity:
    action: error
  
  highSeverity:
    action: warn
  
  malware:
    action: error
  
  protestware:
    action: error
  
  potentialVulnerability:
    action: warn

  # ðŸŸ¡ MEDIUM: Monitor these
  typeModuleNotExportsResolution:
    action: warn
  
  obfuscatedCode:
    action: warn
    comment: "Shai-Hulud uses heavily obfuscated code"
  
  suspiciousString:
    action: warn
  
  unmaintained:
    action: warn

  # ðŸŸ¢ LOW: Informational
  deprecated:
    action: warn
  
  noLicense:
    action: warn

# =============================================================================
# Package Rules - Specific package overrides
# =============================================================================

packageRules:
  # Block known compromised namespaces
  - pattern: "@asyncapi/*"
    action: error
    comment: "Temporarily blocked due to Shai-Hulud 2.0"
  
  - pattern: "@postman/*"
    action: error
    comment: "Temporarily blocked due to Shai-Hulud 2.0"
  
  - pattern: "@posthog/*"
    action: error
    comment: "Temporarily blocked due to Shai-Hulud 2.0"
  
  - pattern: "@zapier/*"
    action: error
    comment: "Temporarily blocked due to Shai-Hulud 2.0"
  
  - pattern: "@ensdomains/*"
    action: error
    comment: "Temporarily blocked due to Shai-Hulud 2.0"
  
  - pattern: "posthog-*"
    action: error
    comment: "Temporarily blocked due to Shai-Hulud 2.0"
  
  - pattern: "zapier-*"
    action: error
    comment: "Temporarily blocked due to Shai-Hulud 2.0"

  # Trust your own packages (adjust namespace)
  - pattern: "@miccy/*"
    action: ignore
    comment: "Trust own packages"

# =============================================================================
# GitHub Integration
# =============================================================================

githubApp:
  enabled: true
  
  # Block PRs that introduce risky packages
  blockPR: true
  
  # Comment on issues
  commentOnIssues: true
  
  # Add labels to PRs
  labels:
    - "socket-security"
  
  # Fail check on errors
  failCheckOnError: true
  
  # Minimum severity to fail
  minSeverityToFail: "high"

# =============================================================================
# Slack/Discord Integration (optional)
# =============================================================================

# notifications:
#   slack:
#     webhook: "${SOCKET_SLACK_WEBHOOK}"
#     channels:
#       - "#security-alerts"
#     minSeverity: "high"

# =============================================================================
# CI/CD Integration
# =============================================================================

cicd:
  # Exit with non-zero code on errors
  exitOnError: true
  
  # Generate SARIF output for GitHub Security tab
  sarifOutput: true
  
  # Output format
  outputFormat: "json"

# =============================================================================
# Ignore Paths
# =============================================================================

ignorePaths:
  - "**/node_modules/**"
  - "**/vendor/**"
  - "**/dist/**"
  - "**/build/**"
  - "**/.git/**"
